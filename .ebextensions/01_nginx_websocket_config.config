files:
  "/etc/nginx/conf.d/websocket.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      # Properly map the upgrade headers for WebSockets
      map $http_upgrade $connection_upgrade {
          default upgrade;
          ''      close;
      }

      # Types hash size settings to address the warnings
      types_hash_max_size 2048;
      types_hash_bucket_size 128;

# DISABLED container_commands to avoid conflicts with .platform/nginx configs
# container_commands:
#   01_remove_default_proxy_conf:
#     command: |
#       rm -f /tmp/deployment/config/#etc#nginx#conf.d#00_elastic_beanstalk_proxy.conf || true
#       rm -f /etc/nginx/conf.d/00_elastic_beanstalk_proxy.conf || true
#   02_create_custom_proxy_conf:
#     command: |
#       cat > /etc/nginx/conf.d/01_streamlit_proxy.conf << 'EOF'
#       ...
#   03_test_nginx_config:
#     command: |
#       result=$(nginx -t 2>&1) || echo "$result"
